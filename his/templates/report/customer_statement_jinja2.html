{%- from "templates/print_formats/standard_macros.html" import add_header,
	 render_field -%}

{% macro get_alignment(col) %}
{%- if col.fieldtype in ('Int', 'Float', 'Currency', 'Check') %} class="text-right" {% endif -%}
{% endmacro %}

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{{ title }}</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<meta name="generator" content="frappe">
	<link type="text/css" rel="stylesheet" href="/assets/css/printview.css">

	<style>
			@media screen {
		     .print-format-gutter {
		         background-color: #d1d8dd;
		         padding: 30px 0px;
		    }
		     .print-format {
		         background-color: white;
		         box-shadow: 0px 0px 9px rgba(0,0,0,0.5);
		         max-width: 8.3in;
		         min-height: 11.69in;
		         padding: 0.25in;
		         margin: auto;
		    }
		     .print-format.landscape {
		         max-width: 11.69in;
		         padding: 0.2in;
		    }
		     .page-break {
		         padding: 30px 0px;
		         border-bottom: 1px dashed #888;
		    }
			
		     .page-break:first-child {
		         padding-top: 0px;
		    }
		     .page-break:last-child {
		         border-bottom: 0px;
		    }
		    /* mozilla hack for images in table */
		     body:last-child .print-format td img {
		         width: 100% !important;
		    }
		     @media(max-width: 767px) {
		         .print-format {
		             padding: 0.2in;
		        }
		    }
		}
		 @media print {
		     .print-format p {
		         margin-left: 1px;
		         margin-right: 1px;
		    }
		}
		
		 .disabled-check {
		     color: #eee;
		}
		 .data-field {
		     margin-top: 5px;
		     margin-bottom: 5px;
		}
		 .data-field .value {
		     word-wrap: break-word;
		}
		 .important .value {
		     font-size: 120%;
		     font-weight: bold;
		}
		 .important label {
		     line-height: 1.8;
		     margin: 0px;
		}
		 .table {
		     margin: 20px 0px;
		}
		 .square-image {
		     width: 100%;
		     height: 0;
		     padding: 50% 0;
		     background-size: contain;
		    /*background-size: cover;
		    */
		     background-repeat: no-repeat !important;
		     background-position: center center;
		     border-radius: 4px;
		}
		 .print-item-image {
		     object-fit: contain;
		}
		 .pdf-variables, .pdf-variable, .visible-pdf {
		     display: none !important;
		}
		 .print-format {
		     font-size: 9pt;
		     font-family: "Helvetica Neue", Helvetica, Arial, "Open Sans", sans-serif;
		     -webkit-print-color-adjust:exact;
		}
		 .print-format table {
		     font-size: 9pt;
		     font-family: "Helvetica Neue", Helvetica, Arial, "Open Sans", sans-serif;
		     -webkit-print-color-adjust:exact;
		}
		 .page-break {
		     page-break-after: always;
		}
		 /* .print-heading {
		     border-bottom: 1px solid #aaa;
		     margin-bottom: 10px;
		} */
		 /* .print-heading h2 {
		     margin: 0px;
		}
		 .print-heading h4 {
		     margin-top: 5px;
		} */
		 table.no-border, table.no-border td {
		     border: 0px;
		}
		 .print-format label {
		    /* wkhtmltopdf breaks label into multiple lines when it is inline-block */
		     display: block;
		}
		 .print-format img {
		     max-width: 100%;
		}
		 .print-format table td > .primary:first-child {
		     font-weight: bold;
		}
		 .print-format td, .print-format th {
		     vertical-align: top !important;
		     padding: 6px !important;
		}
		 .print-format p {
		     margin: 3px 0px 3px;
		}
		 table td div {
		    /* needed to avoid partial cutting of text between page break in wkhtmltopdf */
		     page-break-inside: avoid !important;
		}
		/* hack for webkit specific browser */
		 @media (-webkit-min-device-pixel-ratio:0) {
		     thead, tfoot {
		         display: table-header-group;
		    }
		}
		 [document-status] {
		     margin-bottom: 5mm;
		}
		 .signature-img {
		     background: #fff;
		     border-radius: 3px;
		     margin-top: 5px;
		     max-height: 150px;
		}
		 .print-preview [data-fieldtype="Table"] {
		     overflow: auto;
		}
		 .print-heading {
		     text-align: right;
		     text-transform: uppercase;
		     color: #666;
		     padding-bottom: 20px;
		     margin-bottom: 20px;
		     border-bottom: 1px solid #d1d8dd;
		}
		 .print-heading h2 {
		     font-size: 24px;
		}
		 .print-format th {
		     background-color: #eee !important;
		     border-bottom: 0px !important;
		}
		/* modern format: for-test */

	</style>
</head>


<body>
<div class="print-format-gutter">
		<div class="print-format" class="hidden-pdf">

			<div id="header-html">
				{% if letter_head %}
					<div class="letter-head">{{ letter_head }}</div>
				{% endif %}
			</div>

			<!-- <h2 class="text-center">{{ _("Statement of Account") }}</h2> -->
			<h4 class="text-center">
                {{ frappe.db.get_value("Patient", {"customer": filters['party'][0]}, "patient_name") }}
			</h4>

			<h6>
				{% for key, value in billing_address.items() %}
					{% if value %}
						<b>{{value}}</b><br>
					{% endif %}
				{% endfor %}
			</h6>

			<h5 class="text-center">
				Statement for period:
				{{ frappe.format(filters['from_date'] , {'fieldtype': 'Date'})}}
				{{ _("to") }}
				{{ frappe.format(filters['to_date'] , {'fieldtype': 'Date'})}}
			</h5>
			<hr>

			<table class="table table-bordered">
				<thead>
					<tr>
						<th class="text-center" style="width: 15%">{{ _("Date") }}</th>
						<th class="text-center" style="width: 15%">{{ _("Type") }}</th>
						<!-- <th class="text-center" style="width: 43%">{{ _("Description") }}</th> -->
						<th class="text-center" style="width: 25%">{{ _("Reference") }}</th>
						<th class="text-center" style="width: 12.5%">{{ _("Debit") }}</th>
						<th class="text-center" style="width: 12.5%">{{ _("Credit") }}</th>
						<th class="text-center" style="width: 20%">{{ _("Balance") }}</th>
					</tr>
				</thead>
				<tbody>
					{% for row in data %}
						<tr>
						{% if(row.posting_date) %}
							<td>
							{{ frappe.format(row.posting_date, {'fieldtype': 'Date'})}}</td>
							<td>
								{% if (row.voucher_type == "Sales Invoice") and (row.credit > 0) and (frappe.db.get_value('Sales Invoice',  row.voucher_no  , 'is_return') ==  0) %}
								<span>		<b>{{ _("Invoice") }}</b> <br>
									<span style="font-size: 12px ; font-style: italic;">  Total :</span> {{ frappe.utils.fmt_money(frappe.db.get_value(row.voucher_type, row.voucher_no, "total")  ,currency=currency)}} <br>
									<span style="font-size: 12px ; font-style: italic;">  Discount : </span>{{ frappe.utils.fmt_money(frappe.db.get_value(row.voucher_type, row.voucher_no, "discount_amount") ,currency=currency) }}
								</span>
									{% elif (row.voucher_type == "Sales Invoice") and (row.credit == 0) and (frappe.db.get_value('Sales Invoice',  row.voucher_no  , 'is_return') ==  0) %}
								
									<span>		<b>{{ _("Invoice") }} </b><br>
										<span style="font-size: 12px ; font-style: italic;">  Total :</span> {{ frappe.utils.fmt_money(frappe.db.get_value(row.voucher_type, row.voucher_no, "total")  ,currency=currency)}} <br>
										<span style="font-size: 12px ; font-style: italic;">  Discount : </span>{{ frappe.utils.fmt_money(frappe.db.get_value(row.voucher_type, row.voucher_no, "discount_amount") ,currency=currency) }}
									</span>

									{% elif (row.voucher_type == "Journal Entry") %}
							
									<span>
									<b>{{ _("Transfered") }} </b><br>
									<span style="font-size: 12px ; font-style: italic;"></span> {{ row.remarks or ""}} <br>
									
									</span>


									{% elif (row.voucher_type == "Payment Entry") %}
									{% set p_d = frappe.get_doc("Payment Entry" , row.voucher_no) %}
									<span>
									<b>{{ _("Reciept") }} </b><br>
									<span style="font-size: 12px ; font-style: italic;">  Paid:</span> {{ frappe.utils.fmt_money(p_d.paid_amount  ,currency=currency)}} <br>
									<span style="font-size: 12px ; font-style: italic;">  Discount : </span>{{ frappe.utils.fmt_money(row.credit - p_d.paid_amount ,currency=currency) }}
									</span>
									{% else %}
									
								{% endif %}
								{% if (row.voucher_type == "Sales Invoice" and frappe.db.get_value('Sales Invoice',  row.voucher_no  , 'is_return') == 1) %}
									<span>		{{ _("Return") }} <br>
									<span style="font-size: 12px ; font-style: italic;">  Total :</span> {{ frappe.utils.fmt_money(frappe.db.get_value(row.voucher_type, row.voucher_no, "total")  ,currency=currency)}} <br>
									<span style="font-size: 12px ; font-style: italic;">  Discount : </span>{{ frappe.utils.fmt_money(frappe.db.get_value(row.voucher_type, row.voucher_no, "discount_amount") ,currency=currency) }}
								</span>

								{% endif %}
							</td>
							
							<!-- <td>
								
							
							  </td> -->
							
							<td>
								{%if (row.voucher_type == "Payment Entry") %}

								<a href="/app/payment-entry/{{ row.voucher_no }}" target="_blank">{{ row.voucher_no }}</a> 
								{% endif %}
								{%if (row.voucher_type == "Journal Entry") %}

								<a href="/app/journal-entry/{{ row.voucher_no }}" target="_blank">{{ row.voucher_no }}</a> 
								{% endif %}
								{% if row.voucher_type == "Sales Invoice" %}
								<a href="/app/sales-invoice/{{ row.voucher_no }}" target="_blank">{{ row.voucher_no }}</a> 
								{% set sales_doc = frappe.get_doc("Sales Invoice" , row.voucher_no) %}
			
							

								{% endif %}
								</td>
								<td style="text-align: right">
									{{ frappe.utils.fmt_money(row.debit, currency=currency) }}</td>
								<td style="text-align: right">
									{{ frappe.utils.fmt_money(row.credit, currency=currency) }}</td>
						{% else %}
							<td></td>
							<td></td>
						
							<td><b>{{ row.account | replace("'","") }}</b></td>
							<td></td>
							<td></td>
						
						
							
						{% endif %}
							<td style="text-align: right">
								{{ frappe.utils.fmt_money(row.balance, currency=currency) }}
							</td>
							
						</tr>
						{% if row.voucher_type == "Sales Invoice" %} 
								{% set sales_doc =frappe.get_doc("Sales Invoice" , row.voucher_no) %}
								{% set item_group = [] %} 
								<tr>
									<td></td>
									<td></td>
									<td><strong>Item</strong></td>
									<td><strong>QTY</strong></td>
									<td><strong>Rate</strong></td>
									<td></td>
									<!-- <td><strong>Amount</strong></td> -->
								</tr>
								{% for item in sales_doc.items %} 
								{% if item.item_code %} 
								
							
							
								<tr>
									<td></td>
									<td></td>
									<td>{{ item.item_code }}</td>
									<td>{{ item.qty }}</td>
									<td>${{ item.net_rate }}</td>
									<td></td>
									<!-- <td>${{ item.amount }}</td> -->

								</tr>
								{% endif %}  {% endfor %} {% endif %} 
					{% endfor %}

                    
				</tbody>
			</table>
            <table  class="table table-bordered">
                <tr>
                  <th>Begining</th>
                  <th>Total Depit</th>
                  <th>Total Credit</th>
                  <th>Total Balance</th>
                </tr>
                <tr>
                  <td>{{  frappe.utils.fmt_money(data[0].balance , currency=currency)}}</td>
                  <td>{{  frappe.utils.fmt_money(data[-1].debit , currency=currency)}}</td>
                  <td>{{ frappe.utils.fmt_money(data[-1].credit , currency=currency)}}</td>
                  <td>{{ frappe.utils.fmt_money( data[-1].balance , currency=currency)}}</td>
                </tr>
              </table>
	
			
			<p><b>
				Thank you!
			</b></p>
			<!-- <p>
				Please make payemnts to the company name with details on the latest Invoice.
			</p>
			<p>
				Note: Please confirm the outstanding balance. Should you have any inquiries concerning this statement do contact us on the contact details from the latest invoice.
			</p>
		 -->

			{% if not frappe.db.get_value("System Settings", "System Settings", "hide_footer_in_auto_email_reports")|int %}
			<table class="more-info" border="0" cellpadding="0" cellspacing="0" width="100%" style="max-width: {{ max_width }}">
				<tr>
					<td>
						<p>
							{{ _("This report was generated on {0}").format(date_time) }}
						</p>
					</td>
				</tr>
			</table>
			{% endif %}

		</div>
</div>
<script>
 document.addEventListener('DOMContentLoaded', () => {
	const page_div = document.querySelector('.page-break');

	page_div.style.display = 'flex';
	page_div.style.flexDirection = 'column';

	const footer_html = document.getElementById('footer-html');
	footer_html.classList.add('hidden-pdf');
	footer_html.classList.remove('visible-pdf');
	footer_html.style.order = 1;
	footer_html.style.marginTop = '20px';
 });
</script>
</body>

